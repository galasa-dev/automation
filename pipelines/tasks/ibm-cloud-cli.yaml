#
# Copyright contributors to the Galasa project 
#
apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: ibm-cloud-cli
  namespace: galasa-build
spec:
  params:
  - name: command
    type: array       
  steps:
  - name: ibm-cloud-cli-login
    image: harbor.galasa.dev/common/ibm-cloud-cli:main
    imagePullPolicy: Always
    env:
    - name: IBMCLOUD_API_KEY
      valueFrom:
        secretKeyRef:
          name: ibmcloud-api-key
          key: ibmcloud-api-key
          optional: false
    args:
    - ibmcloud
    - login
# 
  - name: ibm-cloud-cli-command
    image: harbor.galasa.dev/common/ibm-cloud-cli:main
    imagePullPolicy: Always
    env:
    - name: IBMCLOUD_API_KEY
      valueFrom:
        secretKeyRef:
          name: ibmcloud-api-key
          key: ibmcloud-api-key
          optional: false
    args:
    - ibmcloud
    - $(params.command)