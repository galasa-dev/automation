apiVersion: v1
kind: ConfigMap
metadata:
  name: dex-config
  namespace: dex
data:
  galasa-config.yaml: |
    issuer: https://dex.galasa.dev

    storage:
      type: sqlite3
      config:
        file: /var/dex/dex.db

    web:
      http: 0.0.0.0:5556

    staticClients:
    - id: dex
      redirectURIs:
      - 'https://harbor.galasa.dev/c/oidc/callback'
      name: 'harbor'
      secret: <SECRET>

    connectors:
    - type: github
      id: github
      name: Github
      config:
        clientID: $GITHUB_CLIENT_ID
        clientSecret: $GITHUB_CLIENT_SECRET
        redirectURI: https://dex.galasa.dev/callback
        orgs:
        - name: galasa-dev
          teams:
          - code-admin
          - code-committers
        # Flag which indicates that all user groups and teams should be loaded.
        loadAllGroups: false
        useLoginAsID: true

    enablePasswordDB: false
    oauth2:
      skipApprovalScreen: true
