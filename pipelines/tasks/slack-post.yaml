#
# Copyright contributors to the Galasa project
#
# SPDX-License-Identifier: EPL-2.0
#

apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: slack-post
  namespace: galasa-build
spec:
  params:
  - name: pipelineName
    type: string   
  - name: pipelineRunName
    type: string    
  steps:
  - name: make-slack-post
    image: harbor.galasa.dev/galasadev/galasabld-ibm-amd64:main
    imagePullPolicy: Always
    env:
    - name: HOOK
      valueFrom:
        secretKeyRef:
          key: webhook
          name: slack-webhook
          optional: false
    args:
    - slackpost
    - builds
    - --pipeline 
    - $(params.pipelineName)
    - --prun
    - $(params.pipelineRunName)
    - --hook
    - $(HOOK)
