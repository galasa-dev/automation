#
# Copyright contributors to the Galasa project 
#
apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: retag-image
  namespace: galasa-build
spec:
  workspaces:
  - name: git-workspace
    mountPath: /workspace/git
  params:
  - name: pipelineRunName
    type: string
  - name: prImageName
    type: string
  - name: mainImageName
    type: string
  steps:
  # - name: test
  #   workingDir: /workspace/git/$(params.pipelineRunName)
  #   image: harbor.galasa.dev/common/kaniko-executor:latest
  #   command:
  #   - docker
  # - name: start-docker-daemon
  #   workingDir: /workspace/git/$(params.pipelineRunName)
  #   image: docker.io/library/ubuntu:latest
  #   command:
  #   - dockerd
  - name: docker-pull
    workingDir: /workspace/git/$(params.pipelineRunName)
    image: docker.io/library/docker:latest
    command:
    - docker
    - pull
    - $(params.prImageName)
  - name: docker-tag
    workingDir: /workspace/git/$(params.pipelineRunName)
    image: docker.io/library/docker:latest
    command:
    - docker
    - tag
    - $(params.prImageName)
    - $(params.mainImageName)
  - name: docker-push
    workingDir: /workspace/git/$(params.pipelineRunName)
    image: docker.io/library/docker:latest
    command:
    - docker
    - push
    - $(params.mainImageName)